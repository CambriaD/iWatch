#include "iWatch.h"

extern unsigned char xdata main_cache[];
extern unsigned char xdata sub_cache[];

static PageExecuteRate_TypeDef FlashRate = {500, 0};

static unsigned char code Text[] = "FLASH LIGHT";
static unsigned char code Icon[] = {
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xC0,0x80,0x00,0x00,0x00,
0xFF,0xFF,0xFF,0x80,0x00,0x00,0x80,0xC0,0xE0,0xF0,0xF8,0x70,0x20,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0xE0,0xF0,0xF8,0x78,0x3C,0x7E,0xFF,0xE7,0xC3,0x87,0x0F,0x1F,0x1E,0x3C,
0x78,0xF1,0xE1,0xC0,0x80,0x03,0x07,0x67,0xF3,0xE1,0xE0,0xE0,0xE0,0xE0,0xE0,0xE0,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xE0,0xF0,0x78,0x78,0xF0,0xE0,0xC0,
0xE0,0xF0,0x7F,0x3F,0x1F,0x00,0x00,0x00,0x00,0x01,0x03,0x07,0x0F,0x1E,0x3C,0x78,
0xF0,0xE0,0xC1,0x87,0x8F,0xDF,0xFE,0xFC,0x78,0x30,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x0C,0x1E,0xBF,0xFF,0xFB,0xF1,0x78,0x3C,0x1E,0x0F,0x07,0x03,
0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x80,0xC0,0xE0,0xF0,0x78,0x38,0x38,0x38,0x38,
0x38,0x3D,0x3F,0x1F,0x0F,0x03,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x20,0x70,0xF8,0xFC,0xFE,0x8F,0x07,0x03,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x80,
0xC0,0xE0,0xF0,0x78,0x3C,0x1E,0x0F,0x07,0x03,0x01,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x01,0x03,0x07,0x0F,0x1E,0x3C,0x78,0xF8,0x78,0x3C,0x1E,0x0F,0x07,
0x03,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
/* (48 X 48 )*/
};

static bit flash = 0;
/**
  * @brief  页面初始化事件
  * @param  无
  * @retval 无
  */
static void Setup()
{
	ClearCache(sub_cache);
	BMPToCache(40, 1, 48, 48, Icon, sub_cache, COVER);
	PageOpenAnim(ANIM_RIGHT);
	LED(ON);
	ScreenSetInverse(INVERSED);
}
/**
  * @brief  页面退出事件
  * @param  无
  * @retval 无
  */
static void Exit()
{
	LED(OFF);
	ScreenSetInverse(NO_INVERSED);
	PageCloseAnim(ANIM_RIGHT);
}
/**
  * @brief  页面循环执行的内容
  * @param  无
  * @retval 无
  */
static void Loop()
{
	unsigned char k = 0;
	iWatchKeepActive();
	if(flash)
	{
		if(PageExecuteRate(&FlashRate) == 1)
		{
			if(k == 0)
			{
				k = 1;
				LED(k);
			}
			else
			{
				k = 0;
				LED(k);
			}
		}
	}
}
/**
  * @brief  页面事件
  * @param  btn:发出事件的按键
  * @param  event:事件编号
  * @retval 无
  */
static void Event(unsigned char event)
{
	if(event == KEY1)
		PageShift(page_menu);
	else if(event == KEY2)
	{
		if(flash == 0)
			flash = 1;
		else
			FlashRate.executeT /= 2;
	}
	else if(event == KEY3)
	{
		if(flash != 0)
		{
			FlashRate.executeT *= 2;
			if(FlashRate.executeT >= 500)
			{
				FlashRate.executeT = 500;
				flash = 0;
			}
		}
	}
}

void PageRegister_page_flashlight(unsigned char pageID)
{
	PageRegister(pageID, Text, Icon, Setup, Loop, Exit, Event);
}